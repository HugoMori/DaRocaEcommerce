-- SELECT date_part('year',CURRENT_DATE - interval'18 years');
-- SELECT DATE_PART('year',AGE(CURRENT_DATE,'15-03-1994'));
-- SELECT NOW()::TIMESTAMP(0)

/*Cliente*/

CREATE or replace FUNCTION 
cadastro_cliente(_cpf VARCHAR, _nome VARCHAR, _data_nasc DATE,
				_telefone VARCHAR, _email VARCHAR, _senha VARCHAR,
				_endereco TEXT, _cep VARCHAR, _estado CHAR)
RETURNS void AS $$

DECLARE
	dt_cadastro DATE := (SELECT now()::timestamp(0));
	last_login DATE := (SELECT now()::timestamp(0));
	update_reg DATE := (SELECT now()::timestamp(0));

BEGIN
	EXECUTE 'INSERT INTO cliente VALUES (quote_ident($1),
	quote_ident($2),$9 ,quote_ident($3),
	quote_ident($4),quote_ident($5),$10 ,
	$11 ,$12 ,quote_ident($6),
	quote_ident($7), quote_ident($8));' 
	USING _cpf, _nome, _telefone, _email, _senha,
	_endereco, _cep, _estado, _data_nasc, dt_cadastro, 
	last_login, update_reg;
END
$$ LANGUAGE plpgsql;

/*Produto*/

CREATE or replace FUNCTION 
cadastro_produto(_nome VARCHAR, _preco NUMERIC, _qntd_disponivel NUMERIC,
				_categoria SMALLINT, _tipo_venda SMALLINT, _qntd_min_vendida NUMERIC,
				_descricao TEXT, _produtor VARCHAR)
RETURNS void AS $$

DECLARE
	dt_cadastro DATE := (SELECT now()::timestamp(0));
	update_reg DATE := (SELECT now()::timestamp(0));

BEGIN
	EXECUTE 'INSERT INTO produto VALUES (quote_ident($1),
	$2, $3 , $4, $5, $6, null, $7,   
	$8, null, null, quote_ident($8));' 
	USING _nome, _preco, _qntd_disponivel,
		_categoria, _tipo_venda, _qntd_min_vendida,
		dt_cadastro, update_reg, _produtor;
END
$$ LANGUAGE plpgsql;



