DROP TABLE IF EXISTS img_produto;
DROP TABLE IF EXISTS produto;
DROP TABLE IF EXISTS cliente;
-- **************** CLIENTE *************

DROP TABLE IF EXISTS cliente;
CREATE TABLE cliente(
cpf VARCHAR(20) PRIMARY KEY,
nome TEXT NOT NULL, 
data_nasc DATE NOT NULL,
telefone VARCHAR(20) NOT NULL,
email VARCHAR(100) NOT NULL,
senha VARCHAR(12) NOT NULL,
endereco TEXT NOT NULL, 
cep VARCHAR(20) NOT NULL,
cidade VARCHAR(50) NOT NULL,
estado CHAR(2) NOT NULL,
caminho_foto_perfil TEXT,
avaliacao NUMERIC(6,2) DEFAULT 0,
status SMALLINT DEFAULT 1,
vendedor SMALLINT DEFAULT 0,
data_cadastro DATETIME DEFAULT CURRENT_TIMESTAMP,
last_login TIMESTAMP,
update_reg DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
UNIQUE(telefone),
UNIQUE(email)
);


ALTER TABLE cliente ADD CHECK (data_nasc >= '01/01/1900');
ALTER TABLE cliente ADD CHECK (vendedor = 0 OR vendedor = 1);
ALTER TABLE cliente ADD CHECK (status = 0 OR status = 1);

-- **************** PRODUTO *************
-- categoria:
-- 1:Frutas 2:Verduras 3:Legumes 4:Bebidas 5:Frios 6:Especiarias
-- tipo_venda:
-- 1:Kg 2:Caixa 3:Litro 4:DÃºzia 5:unidade
-- status:
-- 0: desativo 1: ativo

CREATE TABLE produto(
codigo SERIAL PRIMARY KEY,
nome VARCHAR(100) NOT NULL,
preco NUMERIC(6,2) NOT NULL,
qntd_disponivel NUMERIC(6,2) NOT NULL, 
categoria SMALLINT NOT NULL,
tipo_venda SMALLINT NOT NULL,
qntd_min_vendida NUMERIC(6,2) NOT NULL,
produtor_fk VARCHAR(100) NOT NULL,
data_producao DATE NOT NULL,
data_validade DATE,
descricao TEXT,
-- CAN BE NULL
status SMALLINT DEFAULT 1,
data_cadastro DATETIME DEFAULT CURRENT_TIMESTAMP,
update_reg DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
avaliacao NUMERIC(6,2) DEFAULT 0,
num_vendas INTEGER DEFAULT 0,
num_visualizacao INTEGER DEFAULT 0,
FOREIGN KEY (produtor_fk) REFERENCES cliente(email) ON UPDATE CASCADE ON DELETE CASCADE 
);

ALTER TABLE produto ADD CHECK(preco > 0);
ALTER TABLE produto ADD CHECK(qntd_disponivel > 0);

ALTER TABLE produto ADD CHECK(
	categoria = 1 OR
	categoria = 2 OR
	categoria = 3 OR
	categoria = 4 OR
	categoria = 5 OR
	categoria = 6);

ALTER TABLE produto ADD CHECK(
	tipo_venda = 1 OR
	tipo_venda = 2 OR
	tipo_venda = 3 OR
	tipo_venda = 4 OR
	tipo_venda = 5 );

ALTER TABLE produto ADD CHECK(
	status = 0 OR
	status = 1 );


-- ============= FOTO PRODUTO 
CREATE TABLE img_produto (
 id_foto SERIAL PRIMARY KEY,
 caminho_foto TEXT NOT NULL,
 produto_fk INTEGER NOT NULL,
 FOREIGN KEY (produto_fk) REFERENCES produto(codigo) ON UPDATE CASCADE ON DELETE CASCADE
);